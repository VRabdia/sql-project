<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Table</title>
    <!-- CDN for Bootstrap CSS (for styling) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h1>Data Table</h1>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>ID</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Gender</th>
            <th>Age</th>
            <th>Weight</th>
            <th>Height</th>
            <th>Health</th>
            <th>History</th>
          </tr>
        </thead>
        <tbody id="data-table-body">
          <!-- Data will be populated here using JavaScript -->
        </tbody>
      </table>
    </div>

    <!-- CDN for Bootstrap JS (for possible future interactivity) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

     <!-- JavaScript to fetch data and populate table -->
     <script>
      // Function to get token from URL parameter
function getTokenFromUrl() {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get('token'); // Assume the token is passed as ?token=your_token
}

      // Retrieve the token from URL
      const apiToken = getTokenFromUrl();

      if (apiToken) {
        console.log('Token retrieved from URL:', apiToken);
      } else {
        console.log('Token not found in URL');
        // Optionally, redirect to login page or prompt user for credentials
      }
      // Fetch data from the Flask API
      function fetchData(apiToken) {
        console.log("FETCHING....")
        fetch("http://127.0.0.1:5000/data", {
          headers: {
            Authorization: `Bearer ${apiToken}`,
          },
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            const tableBody = document.getElementById("data-table-body");

            // Loop through the data and create rows
            data.forEach((item) => {
              const row = document.createElement("tr");
              // Add table cells for each field in the item
              row.innerHTML = `
                <td>${item.id}</td>
                <td>${item.first_name}</td>
                <td>${item.last_name}</td>
                <td>${item.gender}</td>
                <td>${item.age}</td>
                <td>${item.weight}</td>
                <td>${item.height}</td>
                <td>${item.health_history}</td>
              `;

              // Append the row to the table body
              tableBody.appendChild(row);
            });
          })
          .catch((error) => {
            console.error("Error fetching data:", error);
          });
      }
        fetchData(apiToken); // Function to fetch data with the token
    </script>
  </body>
</html>
